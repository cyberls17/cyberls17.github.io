---
layout: post
title: "FTZ level11 풀이"
author: "cyberls17"
---

# FTZ level11 풀이

## 홈 디렉토리 및 힌트 확인
![ftz_level11_home](/images\ftz_level11_home.PNG)<br>
FTZ level11의 홈 디렉토리에 있는 파일들이다.<br>
setuid가 걸려있는 attackme 라는 파일과 이번 문제에 대한 hint 파일이 보인다.<br>

![ftz_level11_hint](/images\ftz_level11_hint.PNG)<br>
hint 파일의 내용이다.<br>
C 소스 코드가 나오는데 이 코드를 해석해보면

> chat str[256]; #문자형인 str배열의 크기를 256byte로 지정<br>
<br>setreuid( 3092, 3092 ); #SetUID를 3092, 3092(level12의 uid)로 지정<br>
strcpy( str, argv[1] ); #사용자가 입력한 값을 str에 복사<br>
printf( str ); #사용자가 입력한 값이 저장된 str 출력<br>

strcpy 함수는 NULL 문자 전까지 문자열을 복사하는 함수이다.<br>
strcpy 함수에는 취약점이 존재하는데 그 취약점은
**문자열의 길이를 검사 하지 않기 때문에 버퍼의 크기보다 더 큰 문자열이 들어갈 경우 overflow가 발생한다는 것**이 취약점이다.<br>

그리고 입력 받는 문자의 크기가 str 배열의 크기인 256byte를 넘었을때에 관련된 코드가 없다.<br>
그렇다면 256byte보다 큰 값을 넣어서 buffer overflow가 일어나게 해 RET 값을 변조할 수 있다는것을 알수 있다.<br>

또 위에 C 소스코드에 있는 setreuid( 3092, 3092 ); 부분이 있는데 여길 보면 
attackme 프로그램에는 level12(3092, 3092) 권한의 setuid가 설정되어 있다는 것을 알 수 있다. <br>
이 프로그램이 실행되는 동안에 my-pass나 /bin/bash 등을 실행시키면 level12의 패스워드를 획득 할 수 있다. shell code를 사용하면 메모리 상에서 /bin/bash를 실행 할수 있다.<br>

### **shell code가 무엇인가?**
쉘코드는 쉘을 실행시키는 기계어 코드이다.


먼저 디버깅을 위해 attackme 파일을 tmp 디렉토리로 복사하고 gdb로 열어서 intel문법으로 표시되게 설정해준뒤 디버깅을 해보자<br>

> gdb -q attackme<br>
set disas intel<br>
disas main<br>

![ftz_level11_gdb_disas_main](/images\ftz_level11_gdb_disas_main.PNG)<br>

gdb